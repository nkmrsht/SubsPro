<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>かんたんサブスク管理</title>
    <!-- Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Additional custom styles if needed */
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-10">
        <!-- Hero Section -->
        <header class="text-center mb-12">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-3">かんたんサブスク管理</h1>
            <p class="text-lg text-gray-600">もう月額サービスを見逃さない</p>
        </header>

        <!-- Input Form Card -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-md mx-auto">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">新規サブスクリプション</h2>
            <form id="subscription-form" class="space-y-4">
                <div>
                    <label for="subscription-name" class="block text-sm font-medium text-gray-700 mb-1">サブスク名</label>
                    <input 
                        type="text" 
                        id="subscription-name" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        required
                    >
                </div>
                <div>
                    <label for="subscription-fee" class="block text-sm font-medium text-gray-700 mb-1">月額料金（円）</label>
                    <input 
                        type="number" 
                        id="subscription-fee" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        min="0" 
                        step="100"
                        required
                    >
                </div>
                <div>
                    <label for="payment-cycle" class="block text-sm font-medium text-gray-700 mb-1">支払いサイクル</label>
                    <select 
                        id="payment-cycle" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="monthly">月払い</option>
                        <option value="yearly">年払い</option>
                    </select>
                </div>
                <button 
                    type="submit" 
                    class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-4 rounded-md transition duration-300"
                >
                    追加
                </button>
            </form>
        </div>

        <!-- Subscription List -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-4xl mx-auto overflow-hidden">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">サブスクリプション一覧</h2>
            
            <div class="overflow-x-auto">
                <table id="subscription-table" class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">サブスク名</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">料金</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">支払いサイクル</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">操作</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <!-- Subscription rows will be added here by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Empty state message -->
            <div id="empty-state" class="py-8 text-center text-gray-500">
                サブスクリプションはまだ登録されていません
            </div>
        </div>

        <!-- Total Monthly Cost -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 max-w-4xl mx-auto">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-semibold text-gray-800">月換算の合計</h2>
                <p id="total-cost" class="text-2xl font-bold text-blue-600">0円</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-gray-500 text-sm mt-12 pb-6">
            <p>© 2025 Lobbdesign LLC</p>
        </footer>
    </div>

    <script>
        // Storage key for localStorage
        const STORAGE_KEY = 'lobbdesign_subs_v1';

        // DOM Elements
        const subscriptionForm = document.getElementById('subscription-form');
        const subscriptionTable = document.getElementById('subscription-table');
        const tableBody = subscriptionTable.querySelector('tbody');
        const emptyState = document.getElementById('empty-state');
        const totalCostElement = document.getElementById('total-cost');
        
        // Subscription data array
        let subscriptions = [];

        /**
         * Format a number as Japanese Yen
         * @param {number} amount - The amount to format
         * @return {string} Formatted amount with yen symbol
         */
        function formatYen(amount) {
            return `${amount.toLocaleString()}円`;
        }

        /**
         * Calculate monthly cost from all subscriptions
         * @return {number} Total monthly cost
         */
        function calculateMonthlyTotal() {
            return subscriptions.reduce((total, subscription) => {
                const fee = parseInt(subscription.fee, 10);
                // Convert yearly payments to monthly
                return total + (subscription.cycle === 'yearly' ? fee / 12 : fee);
            }, 0);
        }

        /**
         * Update the total cost display
         */
        function updateTotalCost() {
            const monthlyTotal = calculateMonthlyTotal();
            totalCostElement.textContent = formatYen(Math.round(monthlyTotal));
        }

        /**
         * Save subscriptions to localStorage
         */
        function saveSubscriptions() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(subscriptions));
        }

        /**
         * Load subscriptions from localStorage
         */
        function loadSubscriptions() {
            const savedData = localStorage.getItem(STORAGE_KEY);
            if (savedData) {
                subscriptions = JSON.parse(savedData);
                renderSubscriptions();
            }
        }

        /**
         * Add a new subscription
         * @param {string} name - Subscription name
         * @param {number} fee - Subscription fee
         * @param {string} cycle - Payment cycle (monthly/yearly)
         */
        function addSubscription(name, fee, cycle) {
            const newSubscription = {
                id: Date.now().toString(), // Use timestamp as unique ID
                name: name,
                fee: fee,
                cycle: cycle
            };
            
            subscriptions.push(newSubscription);
            saveSubscriptions();
            renderSubscriptions();
        }

        /**
         * Remove a subscription by ID
         * @param {string} id - Subscription ID to remove
         */
        function removeSubscription(id) {
            subscriptions = subscriptions.filter(sub => sub.id !== id);
            saveSubscriptions();
            renderSubscriptions();
        }

        /**
         * Render subscriptions to the table
         */
        function renderSubscriptions() {
            // Clear the table first
            tableBody.innerHTML = '';
            
            // Show/hide empty state
            if (subscriptions.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
            
            // Add subscription rows
            subscriptions.forEach(subscription => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                        ${subscription.name}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${formatYen(subscription.fee)}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${subscription.cycle === 'monthly' ? '月払い' : '年払い'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <button 
                            class="text-red-600 hover:text-red-900 focus:outline-none"
                            data-id="${subscription.id}"
                        >
                            ✕
                        </button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Update the total cost
            updateTotalCost();
        }

        // Event Listeners
        
        // Form submission
        subscriptionForm.addEventListener('submit', function(event) {
            event.preventDefault();
            
            const nameInput = document.getElementById('subscription-name');
            const feeInput = document.getElementById('subscription-fee');
            const cycleSelect = document.getElementById('payment-cycle');
            
            const name = nameInput.value.trim();
            const fee = parseInt(feeInput.value, 10);
            const cycle = cycleSelect.value;
            
            if (name && !isNaN(fee) && fee >= 0) {
                addSubscription(name, fee, cycle);
                
                // Reset form
                nameInput.value = '';
                feeInput.value = '';
                cycleSelect.value = 'monthly';
                nameInput.focus();
            }
        });
        
        // Delete button clicks
        tableBody.addEventListener('click', function(event) {
            const deleteButton = event.target.closest('button[data-id]');
            if (deleteButton) {
                const id = deleteButton.getAttribute('data-id');
                removeSubscription(id);
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSubscriptions();
        });
    </script>
</body>
</html>
